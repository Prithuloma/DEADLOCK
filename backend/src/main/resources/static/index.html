<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deadlock Detection & Resolution Platform</title>
    <link rel="stylesheet" href="css/professional-style.css">
    <script src="js/libs/cytoscape.min.js"></script>
    <script src="js/libs/sockjs.min.js"></script>
    <script src="js/libs/stomp.min.js"></script>
    <script src="js/libs/chart.min.js"></script>
</head>
<body>
    <!-- Professional Navigation Header -->
    <nav class="top-navbar">
        <div class="navbar-content">
            <div class="brand">
                <div class="brand-icon">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <circle cx="16" cy="16" r="14" stroke="#4F46E5" stroke-width="2"/>
                        <path d="M16 8V24M8 16H24" stroke="#4F46E5" stroke-width="2"/>
                    </svg>
                </div>
                <div class="brand-text">
                    <h1>Deadlock Detection Platform</h1>
                    <p>Real-time Thread Analysis & Auto-Resolution</p>
                </div>
            </div>
            <div class="navbar-status">
                <div class="status-item">
                    <span class="status-label">Connection</span>
                    <span id="connection-status" class="status-badge status-connecting">
                        <span class="status-dot"></span>
                        Connecting
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">System Status</span>
                    <span id="system-status" class="status-badge status-healthy">
                        <span class="status-dot"></span>
                        Healthy
                    </span>
                </div>
                <div class="status-item">
                    <span class="status-label">Auto-Resolution</span>
                    <span id="auto-resolution-status" class="status-badge status-enabled">
                        <span class="status-dot"></span>
                        Enabled
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard Container -->
    <div class="dashboard-container">
        
        <!-- Left Sidebar - Metrics & Controls -->
        <aside class="sidebar-left">
            
            <!-- ðŸŒ Process Selection Panel -->
            <div class="panel process-panel">
                <div class="panel-header">
                    <h2>Process Monitor</h2>
                    <span class="panel-subtitle">Select Java process to monitor</span>
                </div>
                <div class="panel-body">
                    <div class="process-selector-container">
                        <select id="process-selector" class="process-dropdown">
                            <option value="">Select a Java process...</option>
                        </select>
                        <div class="process-info" id="process-info">
                            <div class="process-info-item">
                                <span class="process-label">PID:</span>
                                <span class="process-value" id="current-pid">None</span>
                            </div>
                            <div class="process-info-item">
                                <span class="process-label">Status:</span>
                                <span class="process-status" id="process-status">Not monitoring</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- System Metrics Panel -->
            <div class="panel metrics-panel">
                <div class="panel-header">
                    <h2>System Metrics</h2>
                    <span class="panel-subtitle">Real-time thread monitoring</span>
                </div>
                <div class="panel-body">
                    <div class="metric-card">
                        <div class="metric-icon metric-icon-primary">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label">Total Threads</div>
                            <div class="metric-value" id="total-threads">0</div>
                            <div class="metric-description">Active application threads</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon metric-icon-success">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                                <path d="M8 12L11 15L16 9" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label">Active Locks</div>
                            <div class="metric-value" id="active-locks">0</div>
                            <div class="metric-description">Synchronized objects in use</div>
                        </div>
                    </div>

                    <div class="metric-card metric-card-alert" id="deadlock-metric">
                        <div class="metric-icon metric-icon-danger">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label">Deadlocked Threads</div>
                            <div class="metric-value" id="deadlocked-threads">0</div>
                            <div class="metric-description">Threads in deadlock state</div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-icon metric-icon-warning">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M12 8V12M12 16H12.01M3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="metric-content">
                            <div class="metric-label">Blocked Threads</div>
                            <div class="metric-value" id="blocked-threads">0</div>
                            <div class="metric-description">Threads waiting for locks</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resolution Statistics -->
            <div class="panel resolution-stats-panel">
                <div class="panel-header">
                    <h2>Resolution Statistics</h2>
                    <span class="panel-subtitle">Auto-resolution performance</span>
                </div>
                <div class="panel-body">
                    <div class="stat-row">
                        <span class="stat-label">Total Resolutions</span>
                        <span class="stat-value" id="total-resolutions">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Success Rate</span>
                        <span class="stat-value stat-value-success" id="success-rate">0%</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Avg Resolution Time</span>
                        <span class="stat-value" id="avg-resolution-time">0ms</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Last Detection</span>
                        <span class="stat-value stat-value-small" id="last-detection">Never</span>
                    </div>
                </div>
            </div>

            <!-- Control Actions -->
            <div class="panel actions-panel">
                <div class="panel-header">
                    <h2>Control Actions</h2>
                    <span class="panel-subtitle">Monitoring controls</span>
                </div>
                <div class="panel-body">
                    <button class="action-btn action-btn-primary" id="refresh-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 7V12L15 15" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Refresh Data</span>
                    </button>

                    <button class="action-btn action-btn-secondary" id="auto-res-toggle">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>ðŸ”„ Auto-Resolution: ON</span>
                    </button>

                    <button class="action-btn action-btn-warning" id="manual-res-trigger">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M13 10V3L4 14h7v7l9-11h-7z" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>âš¡ Trigger Resolution</span>
                    </button>

                    <button class="action-btn action-btn-info" id="res-stats-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="10" width="4" height="11" stroke="currentColor" stroke-width="2"/>
                            <rect x="10" y="6" width="4" height="15" stroke="currentColor" stroke-width="2"/>
                            <rect x="17" y="3" width="4" height="18" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>ðŸ“Š Resolution Stats</span>
                    </button>

                    <button class="action-btn action-btn-info" id="comparison-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                            <rect x="14" y="3" width="7" height="7" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Before/After Analysis</span>
                    </button>

                    <button class="action-btn action-btn-warning" id="snapshot-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Capture Snapshot</span>
                    </button>

                    <button class="action-btn action-btn-success" id="export-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V15M17 10L12 15M12 15L7 10M12 15V3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Export Report</span>
                    </button>
                </div>
            </div>

        </aside>

        <!-- Main Content Area - Graph Visualization -->
        <main class="main-content-area">
            
            <!-- Graph Container -->
            <div class="panel graph-panel">
                <div class="panel-header">
                    <div class="header-left">
                        <h2>Thread Dependency Graph</h2>
                        <span class="panel-subtitle">Visual representation of thread relationships and lock dependencies</span>
                    </div>
                    <div class="header-right">
                        <div class="layout-controls">
                            <span class="layout-label">Layout:</span>
                            <select id="layout-selector" class="layout-select">
                                <option value="cose">Force-Directed</option>
                                <option value="circle">Circle</option>
                                <option value="grid">Grid</option>
                                <option value="breadthfirst">Hierarchical</option>
                            </select>
                        </div>
                        <button class="icon-btn" id="fit-btn" title="Fit to screen">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <path d="M15 3H21M21 3V9M21 3L15 9M9 21H3M3 21V15M3 21L9 15" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </button>
                        <button class="icon-btn" id="help-btn" title="Show help">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <path d="M9 9C9 7.34315 10.3431 6 12 6C13.6569 6 15 7.34315 15 9C15 10.6569 13.6569 12 12 12V14" stroke="currentColor" stroke-width="2"/>
                                <circle cx="12" cy="18" r="1" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="panel-body graph-body">
                    <!-- Legend -->
                    <div class="graph-legend">
                        <h3>Legend</h3>
                        <div class="legend-item">
                            <span class="legend-symbol thread-normal"></span>
                            <span class="legend-label">Normal Thread</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol thread-deadlocked"></span>
                            <span class="legend-label">Deadlocked Thread</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol thread-blocked"></span>
                            <span class="legend-label">Blocked Thread</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol lock-available"></span>
                            <span class="legend-label">Available Lock</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol lock-contested"></span>
                            <span class="legend-label">Contested Lock</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol edge-holding"></span>
                            <span class="legend-label">Holding Lock</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol edge-waiting"></span>
                            <span class="legend-label">Waiting for Lock</span>
                        </div>
                    </div>

                    <!-- Cytoscape Graph Container -->
                    <div id="cy" class="graph-canvas"></div>

                    <!-- Empty State -->
                    <div id="empty-state" class="empty-state">
                        <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
                            <circle cx="60" cy="60" r="50" stroke="#E5E7EB" stroke-width="4"/>
                            <path d="M60 30V60L75 75" stroke="#9CA3AF" stroke-width="4"/>
                        </svg>
                        <h3>No Thread Data Available</h3>
                        <p>Waiting for application data to display thread relationships and dependencies</p>
                        <button class="btn-refresh-empty" id="refresh-empty">Refresh Now</button>
                    </div>
                </div>
            </div>

        </main>

        <!-- Right Sidebar - Activity Feed & Details -->
        <aside class="sidebar-right">
            
            <!-- Activity Timeline -->
            <div class="panel activity-panel">
                <div class="panel-header">
                    <h2>Activity Timeline</h2>
                    <span class="panel-subtitle">Recent system events</span>
                </div>
                <div class="panel-body">
                    <div id="activity-timeline" class="activity-timeline">
                        <div class="activity-item activity-info">
                            <div class="activity-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                    <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">System Started</div>
                                <div class="activity-description">Monitoring initialized</div>
                                <div class="activity-time" id="system-start-time">Just now</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Thread Details Panel -->
            <div class="panel thread-details-panel hidden" id="thread-details-panel">
                <div class="panel-header">
                    <h2>Thread Details</h2>
                    <button class="close-btn" id="close-thread-details">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </button>
                </div>
                <div class="panel-body" id="thread-details-content">
                    <!-- Dynamic thread details will be inserted here -->
                </div>
            </div>

            <!-- System Information -->
            <div class="panel system-info-panel">
                <div class="panel-header">
                    <h2>System Information</h2>
                    <span class="panel-subtitle">JVM details</span>
                </div>
                <div class="panel-body">
                    <div class="info-row">
                        <span class="info-label">JVM Version</span>
                        <span class="info-value" id="jvm-version">Loading...</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Available Processors</span>
                        <span class="info-value" id="cpu-count">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Memory Usage</span>
                        <span class="info-value" id="memory-usage">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Last Update</span>
                        <span class="info-value" id="last-update">Never</span>
                    </div>
                </div>
            </div>

        </aside>

    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>How to Use This Dashboard</h2>
                <button class="close-btn" onclick="document.getElementById('help-modal').classList.add('hidden')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>What is a Deadlock?</h3>
                    <p>A deadlock occurs when two or more threads are blocked forever, each waiting for resources held by the others. This creates a circular dependency where no thread can proceed.</p>
                </div>
                <div class="help-section">
                    <h3>Understanding the Graph</h3>
                    <ul>
                        <li><strong>Circles (Nodes):</strong> Represent threads in your application</li>
                        <li><strong>Rectangles (Nodes):</strong> Represent lock objects (synchronized resources)</li>
                        <li><strong>Solid Arrows:</strong> Show which thread is holding which lock</li>
                        <li><strong>Dashed Arrows:</strong> Show which thread is waiting for which lock</li>
                        <li><strong>Red Color:</strong> Indicates threads involved in a deadlock</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>Auto-Resolution System</h3>
                    <p>Our system automatically detects and resolves deadlocks using intelligent strategies:</p>
                    <ul>
                        <li><strong>Smart Interruption:</strong> Safely interrupts threads to break deadlock cycles</li>
                        <li><strong>Priority-Based:</strong> Uses thread priorities to determine which thread to interrupt</li>
                        <li><strong>Timeout Recovery:</strong> Implements timeouts to prevent indefinite waiting</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>Dashboard Features</h3>
                    <ul>
                        <li><strong>Real-time Monitoring:</strong> Updates every 2 seconds</li>
                        <li><strong>Visual Graph:</strong> Interactive thread dependency visualization</li>
                        <li><strong>Activity Timeline:</strong> Chronological event history</li>
                        <li><strong>Metrics Dashboard:</strong> Key performance indicators</li>
                        <li><strong>Before/After Analysis:</strong> Compare system states</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Load JavaScript -->
    <script src="js/professional-app.js"></script>
</body>
</html>
